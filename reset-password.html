<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Reset Password</title>
</head>

<body>

    <h2>Reset Password</h2>
    <form id="password-reset-form">
        <input type="password" id="password" placeholder="New password" required><br><br>
        <input type="password" id="password2" placeholder="Repeat New password" required><br><br>
        <input type="submit" value="Update Password">
    </form>

    <p id="message"></p>

    <!-- Supabase JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        const supabaseUrl = "https://xcgzdeupoteayfiorscj.supabase.co";
        const supabaseKey = "sb_publishable_2B60fPIaI1PiLYcvCfgGYA_KveaLaEv";
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        //selects the password reset form
        const passwordResetForm = document.getElementById("password-reset-form");
        passwordResetForm.addEventListener("submit", (e) => {
            e.preventDefault();
            let password1 = document.getElementById("password").value;
            let password2 = document.getElementById("password2").value;
            if (password1 !== password2) {
                alert("The passwords you entered do not match.\nPlease check and try again.");
                return;
            }
            updatePassword();
        });

        async function updatePassword() {
            const newPassword = document.getElementById("password").value;

            const { error } = await supabaseClient.auth.updateUser({
                password: newPassword
            });

            document.getElementById("message").textContent =
                error ? error.message : "Password updated successfully!";

            if (!error) {
                setTimeout(() => {
                    window.location.href = "sign-in.html";
                }, 2000);
            }
        }

    </script>

</body>

</html>